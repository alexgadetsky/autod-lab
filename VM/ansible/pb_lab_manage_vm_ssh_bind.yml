---
- name: ssh-copy-id
  gather_facts: false
  hosts: all
  user: root
  vars_files:
     group_vars/all.yml
  
  tasks:
  - name: ssh-copy-id NexentaStor
    shell: "sshpass -p plusultra ssh-copy-id root@{{ vars['guest.ipAddress'] }}"
    delegate_to: localhost
    when: "(vm_state is not defined) and (vars['config.name'] | regex_search('NS'))"

  - name: ssh-copy-id Firecrest and Ubuntu
    shell: "sshpass -p nexenta ssh-copy-id root@{{ vars['guest.ipAddress'] }}"
    delegate_to: localhost
    when: "(vm_state is not defined) and ((vars['config.name'] | regex_search('firecrest')) or (vars['config.name'] | regex_search('Ubuntu')))"
...
